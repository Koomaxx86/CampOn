<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace="매퍼 인터페이스 경로" -->
<mapper namespace="com.camp.campon.mapper.CampMapper">

    <!-- 캠프 목록 -->
    <select id="list" resultType="Camp">
        SELECT * 
        FROM campproduct
    </select>
    
    <select id="cpdtlist" resultType="Camp">
        SELECT *
        FROM campdetail
    </select>

    <select id="campSelect" resultType="Camp">
        SELECT *
        FROM campproduct c
        JOIN campdetail cd ON c.camp_no = cd.camp_no
        JOIN camptype ct ON cd.camptype_no = ct.camptype_no
        JOIN campimg img ON c.camp_no = img.camp_no 
        JOIN (SELECT min(cpi_no) no FROM campimg GROUP BY camp_no) imgno ON img.cpi_no = imgno.no
        WHERE ct.camptype_no = #{campTypeNo}
        ORDER BY c.camp_no DESC;
    </select>
    
    <!-- 캠프 최신목록 -->
    <select id="newList" resultType="Camp">
        SELECT * 
        FROM campproduct c 
        join campimg img on c.camp_no = img.camp_no 
        join (select min(cpi_no) no from campimg group by camp_no) imgno on img.cpi_no = imgno.no
        order by c.reg_date desc limit 6
    </select>
    
    <!-- 캠프 추천목록 -->
    <select id="hotList" resultType="Camp">
        SELECT * 
        FROM campproduct c 
        join campimg img on c.camp_no = img.camp_no 
        join (select min(cpi_no) no from campimg group by camp_no) imgno on img.cpi_no = imgno.no
        join (select camp_no, count(*) c from reservation group by camp_no) r on c.camp_no = r.camp_no
        order by r.c desc limit 6
    </select>

    <!-- 캠핑 타입 목록 -->
    <select id="camptype" resultType="Camp">
        SELECT *
        FROM camptype
    </select>

    <!-- 캠핑장 등록 -->
    <insert id="insertCamp">
        
    </insert>
    <!-- 캠프상품 등록 -->

    <!-- 캠핑장 수정 -->

    <!-- 캠프상품 수정 -->

    <!-- 캠핑장 삭제 -->

    <!-- 캠프상품 삭제-->

    <!-- 오픈일정 가져오기 -->
    <select id="schedule" resultType="Camp">
        SELECT *
        FROM campproduct c
        JOIN campdetail cd ON c.camp_no = cd.camp_no
        JOIN camptype ct ON cd.camptype_no = ct.camptype_no
        JOIN campimg img ON c.camp_no = img.camp_no 
        JOIN (SELECT min(cpi_no) no FROM campimg GROUP BY camp_no) imgno ON img.cpi_no = imgno.no
        WHERE c.camp_open BETWEEN #{campOpen} AND #{campClose}
        ORDER BY c.camp_no DESC;
    </select>
    <!-- 예약일정 가져오기 -->
    <select id="reservation" resultType="Camp">
        SELECT * 
        FROM reservation re
        JOIN campproduct c ON re.camp_no = c.camp_no
        JOIN campimg img ON c.camp_no = img.camp_no 
        JOIN (SELECT min(cpi_no) no FROM campimg GROUP BY camp_no) imgno ON img.cpi_no = imgno.no
        WHERE re.user_no = #{userNo}
        ORDER BY c.camp_no DESC;
    </select>
    
    <!-- 찜 상품 목록 -->
    <select id="favoritesList" resultType="Camp">
        SELECT * FROM favorites f join campproduct c on f.camp_no = c.camp_no ORDER BY favorites_no DESC
    </select>
    <!-- 찜 상품 삭제 -->
    <delete id="favoriteDelete">
        DELETE FROM favorites WHERE favorites_no = #{favoritesNo}
    </delete>

    <!--캠핑장페이지-->
    <select id="productsimg" resultType="Camp">
        select * from campimg where camp_no = #{campNo}
    </select>
    <select id="productsproducts" resultType="Camp">
        select * from campproduct where camp_no = #{campNo}
    </select>
    <select id="productsreserve">
        select count(*) from reservation where camp_no = #{campNo}
    </select>
    <select id="productsenvironment" resultType="Camp">
        select * from environmenttype t join environment e on t.environmenttype_no = e.environmenttype_no where camp_no = (select camp_no from campproduct where camp_no = #{campNo})
    </select>
    <select id="productsfacility" resultType="Camp">
        select * from facility f join facilitytype ft on f.facilitytype_no = ft.facilitytype_no where f.camp_no =#{campNo}
    </select>

</mapper>